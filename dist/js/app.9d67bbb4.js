(function(){"use strict";var e={7404:function(e,t,r){var n=r(7195),o=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[e.shouldDisplayNavbar?t("navbar"):e._e(),t("main",[t("router-view")],1)],1)},a=[],s=function(){var e=this,t=e._self._c;return t("header",{staticClass:"header"})},i=[],c={name:"Header",components:{}},u=c,l=r(1001),m=(0,l.Z)(u,s,i,!1,null,null,null),p=m.exports,d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"navbar"},[t("LoginBtn"),t("ProfileBtn")],1)},f=[],h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"btn"},[t("router-link",{attrs:{to:"/login"}},[e._v("Login")])],1)},v=[],y={name:"LoginBtn"},g=y,w=(0,l.Z)(g,h,v,!1,null,null,null),P=w.exports,_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"btn"},[t("router-link",{attrs:{to:"/profile"}},[e._v("Profile")])],1)},k=[],b={name:"ProfileBtn"},N=b,S=(0,l.Z)(N,_,k,!1,null,null,null),E=S.exports,T={name:"navbar",components:{LoginBtn:P,ProfileBtn:E},data(){return{}}},Z=T,L=(0,l.Z)(Z,d,f,!1,null,"3a362a18",null),O=L.exports,I={name:"App",components:{Header:p,navbar:O},computed:{shouldDisplayNavbar(){const e=["/login","/register"];return!e.includes(this.$route.path)}}},x=I,M=(0,l.Z)(x,o,a,!1,null,null,null),$=M.exports,C=r(408),U=r(4582);const F=async(e,t,r)=>{try{const n=await U.Z.patch(`https://api.tvoyvpn.com/api/users/profiles/${e}`,r,{headers:{Authorization:`Bearer ${t}`}});return 200!==n.status?(console.error("Failed to update user profile"),null):n.data.profile}catch(n){return console.error("Error updating user profile:",n),null}};r(3429);const R=async e=>{try{const t=e.split(".")[1],r=t.replace(/-/g,"+").replace(/_/g,"/"),n=JSON.parse(atob(r)),o=n.id,a=await U.Z.get(`https://api.tvoyvpn.com/api/users/profiles/${o}`,{headers:{Authorization:`Bearer ${e}`}});return 200!==a.status?(console.error("Failed to retrieve user profile"),null):{profile:a.data.profile,userId:o}}catch(t){return console.error("Error while getting user information:",t),null}},j=async(e,t)=>{try{const r=await U.Z.post("https://api.tvoyvpn.com/api/users/login",{email:e,password:t});return 201!==r.status?(console.error("Login error"),null):r.data.access_token}catch(r){return console.error("Login error:",r.response),null}},B={token:localStorage.getItem("token")||null,userProfile:null,userId:""},D={token:e=>e.token,userProfile:e=>e.userProfile,userId:e=>e.userId},W={setToken(e,t){e.token=t},setUserId(e,t){e.userId=t},setUserProfile(e,t){e.userProfile=t},clearToken(e){e.token=null},updateUserProfile(e,t){e.userProfile=Object.assign({},e.userProfile,t)}},A={async login({commit:e,dispatch:t},{email:r,password:n}){const o=await j(r,n);o&&(e("setToken",o),localStorage.setItem("token",o),await t("userProfile"))},async userProfile({state:e,commit:t}){if(!e.token)return void console.error("Token is missing");const r=await R(e.token);r&&(t("setUserProfile",r.profile),t("setUserId",r.userId))},async updateUserProfile({state:e,commit:t},r){const n=await F(e.userId,e.token,r);n&&t("updateUserProfile",n)},logout({commit:e}){e("clearToken"),localStorage.removeItem("token")}};var z={namespaced:!0,state:B,getters:D,mutations:W,actions:A},H={returnUrl:"http://localhost:8080/profile",paymentMethod:"bank_card",capture:!0,description:"Описание платежа"},K={namespaced:!0,getters:{},state:{},mutations:{},actions:{async createPayment({commit:e},{amount:t,currency:r}){const n={amount:{value:t,currency:r},confirmation:{type:"redirect",return_url:H.returnUrl},payment_method_data:{type:H.paymentMethod},capture:H.capture,description:H.description};try{const e=await U.Z.post("https://api.tvoyvpn.com/api/create-payment/",n);return console.log(e.data.id),window.location.href=e.data.confirmation.confirmation_url,e.data}catch(o){console.error(o)}},async recordPayment({commit:e},{userId:t,paymentData:r}){try{const e=await U.Z.post("https://api.tvoyvpn.com/api/record-payment/",{userId:t,paymentData:{paymentId:r.id,status:r.status,amount:r.amount.value}});return e}catch(n){console.error(n)}}}},V=r(4509);const q="http://185.125.201.105:5000";var J={namespaced:!0,state:{socket:null,paymentStatus:null,reconnectError:!1},mutations:{SET_SOCKET(e,t){e.socket=t},SET_PAYMENT_STATUS(e,t){e.paymentStatus=t},SET_RECONNECT_ERROR(e,t){e.reconnectError=t}},actions:{initWebSocket({commit:e,state:t,dispatch:r}){const n=localStorage.getItem("token"),o=(0,V.ZP)(q,{query:{token:n,autoConnect:!1}});o.on("connect",(()=>{console.log("WebSocket connected"),e("SET_RECONNECT_ERROR",!1)})),o.on("disconnect",(()=>{console.log("WebSocket disconnected")})),o.on("connect_error",(e=>{console.error("Connection Error",e)})),o.io.on("close",(()=>{r("reconnectWebSocket")})),o.on("paymentCreated",(e=>{e||data.paymentId?r("fetchPaymentStatus",e):console.error("Payment ID was not provided with payment confirmation.")})),e("SET_SOCKET",o),o.connect()},fetchPaymentStatus({commit:e},t){try{return U.Z.get(`${q}/payments/${t}/status`)}catch(r){console.error("Ошибка при получении статуса платежа",r)}},initializeWebSocketListeners({dispatch:e}){const t=this.$socket;t.on("paymentCreated",(t=>{t?e("fetchPaymentStatus",t):console.error("Payment ID was not provided with payment confirmation")}))},disconnectWebSocket({state:e}){e.socket&&e.socket.disconnect()},reconnectWebSocket({commit:e,state:t,dispatch:r}){t.socket&&!t.socket.connected&&(setTimeout((()=>{t.socket.connect()}),5e3),e("SET_RECONNECT_ERROR",!0))}},getters:{paymentStatus:e=>e.paymentStatus}};n.ZP.use(C.ZP);var Y=new C.ZP.Store({modules:{authModule:z,paymentModule:K,socketModule:J}}),G=r(2241),Q=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"div"}},[t("UserProfile")],1)},X=[],ee=function(){var e=this,t=e._self._c;return t("div",[t("PaymentVpn"),t("h2",[e._v("User Profile")]),t("p",[e._v("Имя: "+e._s(e.userFirstName))]),t("p",[e._v("Фамилия: "+e._s(e.userLastName))]),t("br"),t("h2",[e._v("Редактировать профиль пользователя")]),t("div",[t("label",{attrs:{for:"firstName"}},[e._v("Имя:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newFirstName,expression:"newFirstName"}],attrs:{id:"firstName"},domProps:{value:e.newFirstName},on:{input:function(t){t.target.composing||(e.newFirstName=t.target.value)}}})]),t("div",[t("label",{attrs:{for:"lastName"}},[e._v("Фамилия:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newLastName,expression:"newLastName"}],attrs:{id:"lastName"},domProps:{value:e.newLastName},on:{input:function(t){t.target.composing||(e.newLastName=t.target.value)}}})]),t("button",{on:{click:e.updateProfile}},[e._v("Сохранить")])],1)},te=[],re=function(){var e=this,t=e._self._c;return t("div",[t("h1",[e._v("Впн")]),t("h3",[e._v("Регони: Нидерланды")]),t("h3",[e._v("1 месяц")]),t("button",{on:{click:e.initiatePayment}},[e._v("Купить")])])},ne=[],oe={data(){return{amount:"999",currency:"RUB"}},created(){this.$store.dispatch("socketModule/initWebSocket")},beforeDestroy(){this.$store.dispatch("socketModule/disconnectWebSocket")},methods:{async initiatePayment(){const e=this.$store.state.authModule.userId;if(!e)throw new Error("User not authenticated.");try{const t=await this.$store.dispatch("paymentModule/createPayment",{amount:this.amount,currency:this.currency});t&&t.id&&await this.savePayment(e,t)}catch(t){console.error("Error during payment initiation:",t)}},savePayment(e,t){try{this.$store.dispatch("paymentModule/recordPayment",{userId:e,paymentData:t})}catch(r){console.error(r)}}},computed:{isReconnectError(){return this.$store.state.socketModule.reconnectError}},watch:{isReconnectError(){return console.log("reconnect errror"),this.$store.state.socketModule.reconnectError}}},ae=oe,se=(0,l.Z)(ae,re,ne,!1,null,"1025dd00",null),ie=se.exports,ce={components:{PaymentVpn:ie},data(){return{newFirstName:"",newLastName:""}},computed:{...(0,C.Se)("authModule",["userProfile"]),userFirstName(){return this.userProfile?this.userProfile.firstName:null},userLastName(){return this.userProfile?this.userProfile.lastName:null}},methods:{...(0,C.nv)("authModule",["updateUserProfile"]),async updateProfile(){const e={firstName:this.newFirstName||this.userFirstName,lastName:this.newLastName||this.userLastName};await this.updateUserProfile(e),this.newFirstName=this.userFirstName,this.newLastName=this.userLastName}},mounted(){this.$store.dispatch("authModule/userProfile"),this.newFirstName=this.userFirstName,this.newLastName=this.userLastName}},ue=ce,le=(0,l.Z)(ue,ee,te,!1,null,null,null),me=le.exports,pe={name:"profile",components:{UserProfile:me}},de=pe,fe=(0,l.Z)(de,Q,X,!1,null,null,null),he=fe.exports,ve=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"div"}},[t("Login")],1)},ye=[],ge=function(){var e=this,t=e._self._c;return t("form",{on:{submit:function(t){return t.preventDefault(),e.login.apply(null,arguments)}}},[t("div",[t("label",{attrs:{for:"email"}},[e._v("Email:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],attrs:{type:"text",id:"email"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})]),t("div",[t("label",{attrs:{for:"password"}},[e._v("Password:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",id:"password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e._m(0)])},we=[function(){var e=this,t=e._self._c;return t("div",[t("button",{attrs:{type:"submit"}},[e._v("Login")])])}],Pe=(r(560),{data(){return{email:"",password:""}},methods:{async login(){await this.$store.dispatch("authModule/login",{email:this.email,password:this.password}),this.$router.push({name:"profile"})}}}),_e=Pe,ke=(0,l.Z)(_e,ge,we,!1,null,null,null),be=ke.exports,Ne={name:"login",components:{Login:be}},Se=Ne,Ee=(0,l.Z)(Se,ve,ye,!1,null,null,null),Te=Ee.exports;n.ZP.use(G.ZP);const Ze=new G.ZP({mode:"history",routes:[{path:"/profile",name:"profile",component:he},{path:"/login",name:"login",component:Te}]});var Le=Ze;n.ZP.config.productionTip=!1,new n.ZP({store:Y,router:Le,render:e=>e($)}).$mount("#app")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.m=e,function(){var e=[];r.O=function(t,n,o,a){if(!n){var s=1/0;for(l=0;l<e.length;l++){n=e[l][0],o=e[l][1],a=e[l][2];for(var i=!0,c=0;c<n.length;c++)(!1&a||s>=a)&&Object.keys(r.O).every((function(e){return r.O[e](n[c])}))?n.splice(c--,1):(i=!1,a<s&&(s=a));if(i){e.splice(l--,1);var u=o();void 0!==u&&(t=u)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[n,o,a]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,s=n[0],i=n[1],c=n[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(c)var l=c(r)}for(t&&t(n);u<s.length;u++)a=s[u],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(l)},n=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=r.O(void 0,[998],(function(){return r(7404)}));n=r.O(n)})();
//# sourceMappingURL=app.9d67bbb4.js.map